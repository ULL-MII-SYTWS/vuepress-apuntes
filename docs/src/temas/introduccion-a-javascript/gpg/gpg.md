# gpg guide

See https://github.com/bfrg/gpg-guide

## Error when making a commit in a codespace

```
@crguezl ➜ /workspaces/nextra-docs-template (main) $ GIT_TRACE=1 git commit
12:01:42.989023 git.c:472               trace: built-in: git commit
hint: Waiting for your editor to close the file... 
  12:01:42.998507 run-command.c:666       
    trace: run_command: 
    GIT_INDEX_FILE=.git/index 
    'code --wait' /workspaces/nextra-docs-template/.git/COMMIT_EDITMSG
  12:01:42.998573 run-command.c:758       
    trace: start_command: /bin/sh -c 'code --wait "$@"' 'code --wait' /workspaces/nextra-docs-template/.git/COMMIT_EDITMSG
  12:02:39.227844 run-command.c:666       
    trace: run_command: /.codespaces/bin/gh-gpgsign --status-fd=2 -bsau 'GitHub <noreply@github.com>'
  12:02:39.227868 run-command.c:758       
    trace: start_command: /.codespaces/bin/gh-gpgsign --status-fd=2 -bsau 'GitHub <noreply@github.com>'
    error: gpg failed to sign the data:
  [GNUPG:] BEGIN_SIGNING
  2024/10/31 12:02:39 error signing commit: 
    error signing commit: error making request: 403 | 
          Current user User does not have push access to this repository, error making request: 403 | 
          Current user User does not have push access to this repository

  fatal: failed to write commit object
```

## GPG configuration files

The home directory where **GnuPG** and its helper tools look for configuration
files defaults to `~/.gnupg/` (see also `--homedir` option). By default the
directory has its permissions set to `700`, and the files it contains have their
permissions set to `600`. It is very important to keep `~/.gnupg/` private and
have a secure backup stored on a seperate disk as it contains all files
generated by the `gpg` command including the private keys.

For most users the following files are sufficient:
* `gpg.conf`: standard configuration file read by `gpg` on startup. It may
  contain any long options that are available for `gpg`. A skeleton
  configuration file is generated on the very first run of `gpg`.
* `gpg-agent.conf`: standard configuration file read by `gpg-agent` on startup.
  The `gpg-agent` is a daemon to request and cache passphrases used by `gpg`.
* `dirmngr.conf`: standard configuration file read by `dirmngr` on startup.
  `dirmngr` takes care of accessing the OpenPGP keyservers and is also used for
  managing and downloading certificate revocation lists. A skeleton
  configuration file is generated on the very first run of `gpg`. 

  ## Creating new keys

First create a new keypair (private and public key):
```bash
$ gpg --full-gen-key
```

The user will be prompted to answer several questions:
1. Keypair: The default is `RSA and RSA`. This means there will be one master
   key for signing and one subkey for encryption.
2. Keysize: A keysize of 2048 is usually enough.
3. Expiration date: A period of a year is enough most of the time. See
   [Editing keys](#editing-keys) on how to change it afterwards.
4. Name and email address.
5. Comment: Add a comment for the key's purpose.
6. Passphrase.

```bash
➜  src git:(main) ✗ gpg --full-gen-key
gpg (GnuPG) 2.4.5; Copyright (C) 2024 g10 Code GmbH
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Por favor seleccione tipo de clave deseado:
   (1) RSA and RSA
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
   (9) ECC (sign and encrypt) *default*
  (10) ECC (sólo firmar)
  (14) Existing key from card
Su elección: 1
las claves RSA pueden tener entre 1024 y 4096 bits de longitud.
¿De qué tamaño quiere la clave? (3072) 
El tamaño requerido es de 3072 bits
Por favor, especifique el período de validez de la clave.
         0 = la clave nunca caduca
      <n>  = la clave caduca en n días
      <n>w = la clave caduca en n semanas
      <n>m = la clave caduca en n meses
      <n>y = la clave caduca en n años
¿Validez de la clave (0)? 1y
La clave caduca vie 31 oct 12:32:49 2025 WET
¿Es correcto? (s/n) s

GnuPG debe construir un ID de usuario para identificar su clave.

Nombre y apellidos: Casiano Rodriguez-Leon
Dirección de correo electrónico: crguezl@ull.edu.es
Comentario: Universidad de La Laguna
Ha seleccionado este ID de usuario:
    "Casiano Rodriguez-Leon (Universidad de La Laguna) <crguezl@ull.edu.es>"

¿Cambia (N)ombre, (C)omentario, (D)irección o (V)ale/(S)alir? V
Es necesario generar muchos bytes aleatorios. Es una buena idea realizar
alguna otra tarea (trabajar en otra ventana/consola, mover el ratón, usar
la red y los discos) durante la generación de números primos. Esto da al
generador de números aleatorios mayor oportunidad de recoger suficiente
entropía.
Es necesario generar muchos bytes aleatorios. Es una buena idea realizar
alguna otra tarea (trabajar en otra ventana/consola, mover el ratón, usar
la red y los discos) durante la generación de números primos. Esto da al
generador de números aleatorios mayor oportunidad de recoger suficiente
entropía.
gpg: /Users/casianorodriguezleon/.gnupg/trustdb.gpg: se ha creado base de datos de confianza
gpg: creado el directorio '/Users/casianorodriguezleon/.gnupg/openpgp-revocs.d'
gpg: certificado de revocación guardado como '/Users/casianorodriguezleon/.gnupg/openpgp-revocs.d/8D88F9CD927812BEC25808E8B7F38764F14F26A1.rev'
claves pública y secreta creadas y firmadas.

pub   rsa3072 2024-10-31 [SC] [caduca: 2025-10-31]
      8D88F9CD927812BEC25808E8B7F38764F14F26A1
uid                      Casiano Rodriguez-Leon (Universidad de La Laguna) <crguezl@ull.edu.es>
sub   rsa3072 2024-10-31 [E] [caduca: 2025-10-31]
```

```bash
➜  src git:(main) ✗ ls -latr ~/.gnupg/
total 16
-rw-r-----@   1 casianorodriguezleon  staff    12 31 oct 12:25 common.conf
srwx------@   1 casianorodriguezleon  staff     0 31 oct 12:31 S.gpg-agent.extra
srwx------@   1 casianorodriguezleon  staff     0 31 oct 12:31 S.gpg-agent.browser
srwx------@   1 casianorodriguezleon  staff     0 31 oct 12:31 S.gpg-agent.ssh
srwx------@   1 casianorodriguezleon  staff     0 31 oct 12:34 S.gpg-agent
srwx------@   1 casianorodriguezleon  staff     0 31 oct 12:34 S.keyboxd
drwx------@   4 casianorodriguezleon  staff   128 31 oct 12:34 private-keys-v1.d
drwxr-x---@   5 casianorodriguezleon  staff   160 31 oct 12:34 public-keys.d
-rw-------@   1 casianorodriguezleon  staff  1240 31 oct 12:34 trustdb.gpg
drwx------@   3 casianorodriguezleon  staff    96 31 oct 12:34 openpgp-revocs.d
drwx------@  12 casianorodriguezleon  staff   384 31 oct 12:34 .
drwxr-xr-x+ 160 casianorodriguezleon  staff  5120 31 oct 12:39 ..
```

## About adding GPG keys to your GitHub account

See https://docs.github.com/en/authentication/managing-commit-signature-verification/adding-a-gpg-key-to-your-github-account