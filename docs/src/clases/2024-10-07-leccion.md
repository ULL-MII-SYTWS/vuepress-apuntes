---
title: "Lunes 2024/10/07 semana C"
published: true
summary: "AsyncMap, Race Conditions in JS, Jekyll, SSG"
labs: [ "ides", "asyncmap", "race-condition", "intro2sd" ]
temas: 
  - text: "Introduction to the Event Loop"
    href: "/temas/async/event-loop"
  - text: "Codespaces"
    href: "/temas/introduccion-a-javascript/codespaces"
  - text: "Commander npm package"
    href: "/practicas/asyncmap.html#commander"
  - text: "Static Site Generators: Jekyll"
    href: "/temas/web/jekyll"
next: 
prev: 2024-10-02-leccion.md # 
---

# {{ $frontmatter.title }}

## Estado de las entregas

* [Informe del calificador](https://campusdoctoradoyposgrado2425.ull.es/grade/report/grader/index.php?id=2425110680)

## GitHub Project Boards

<youtube id="oPQgFxHcjAw?si=vVGz7KrgI7ZLRnZpW"></youtube>


## Lab "IDEs"

Exercise: [Personalizing your Codespace](/temas/introduccion-a-javascript/codespaces.html#exercise-personalizing-your-codespace)


## Lab "Async map"

Vamos a seguir  trabajando en el lab:

*   Lab [Async map](/practicas/asyncmap.html)
    *   [Grading Rubric](/practicas/asyncmap.html#rubrica)
    *   [Repos](https://github.com/orgs/ULL-MII-SYTWS-2425/repositories?q=asyncmap)

Este es el plan de trabajo:

Complete el ejercicio de generalizar [callback-hell-example.mjs](https://github.com/ULL-MII-SYTWS-2324/asyncmap-casiano-rodriguez-leon-alu0100291865/blob/callbackhell-solution/callback-hell-example.mjs) para `n` ficheros 

```js
// Create the inputs: npm run create-inputs
// Execute it with: node callback-hell-example.mjs -f test/f*
import fs from 'fs';
import { Command } from 'commander';
const program = new Command();

program.option('-f, --files <values...>', 'Ficheros de entrada', []);
program.parse(process.argv);
const files = program.files; // ['test/f1.txt', 'test/f2.txt', 'test/f3.txt']
console.log(files);

function rF(name, cb) {
  fs.readFile(name, 'utf8', cb);
}

function readSeq(files, finalCb) {
  let results = [];

  function next(i) {
    if (i < files.length) {
      rF(files[i], (err, data) => {
        ... // Write your code here
        //console.log(data)
        next(i+1);
      });
    } else {
      ... // Write your code here
    }
  }
  next(0);
}

readSeq(files, (err, data) => {
  if (err) {
    console.error(err);
    return;
  }
  console.log(data);
});
```

Generalize la solución encontrada y rellene en `concatSerialize.js` el código para la función `series` que resuelve el problema de serializar llamadas a funciones asíncronas

```js
//node concatSerialize.js -f f1.txt -f f2.txt -f f3.txt -o output.txt
/* ... */
var series = function (inputs, fun, callback) {
    var arr = []
    var index = 0;
    function aux() {
        fun(inputs[index++], (error, data) => {
            if (error) {
                /* ... your code here  */
            } else {
                /* ... your code here  */
            }
        })
    }

    aux()
}

                   // results is an array of strings containing the contents of the files
series(program.files, (file, cb) => fs.readFile(file, "utf-8", cb), function (err, results) {
    if (err == null) {
        var file = fs.createWriteStream(program.output);
        file.on('error', err => { throw new Error("Error en la apertura del archivo " + program.output + " " + err) });
        results.forEach(i => { file.write(i + '\n'); });
        file.end();
    } else {
        throw new Error("Fallo en la lectura de los ficheros\n" + err)
    }
});
```

1. Añada un fichero `sol-using-async.mjs` que resuelva el mismo problema pero usando la función [series](https://caolan.github.io/async/v3/docs.html#series) de `Async`  
2. Edite `sol-using-async.mjs` para que usando la función [map](https://caolan.github.io/async/v3/docs.html#map) de Async resuelva el problema de la lectura de ficheros pero en paralelo: esto es, no se espera a que termine la lectura de un fichero para empezar a leer el siguiente.
3. Edite `my-async.mjs` y provea su propia función`asyncMap` que funciona como el [map](https://caolan.github.io/async/v3/docs.html#map)de `Async`


Dejamos aquí un enlace a los apuntes de "[Introduction to the JS Event Loop](/temas/async/event-loop/)"

## Lab Race Condition: Loading an image with some delay

Discutiremos el tema de las race condition en JS usando este lab:

*  [Description](/practicas/race-condition.html)

## Lab Introduction to Systems Development and Static Generators

* Description of the lab [Introduction to Systems Development" and Static Generators](/practicas/intro2sd.html)
* [Repos](https://github.com/orgs/ULL-MII-SYTWS-2425/repositories?q=intro2sd) de esta práctica
* [Grading Rubric](/practicas/intro2sd.html#rubrica) for this lab


## Temas que veremos en clase

Veremos como hacer que [nuestros  Codespaces carguen ciertos scripts y aliases al arrancar](/temas/introduccion-a-javascript/codespaces.html#personalizing-your-codespace).

<ul>
    <li  v-for="(tema, index) in $frontmatter.temas" :key="index">
    <a :href="tema.href">{{tema.text}}</a>
    </li>
</ul>

## Labs que veremos en clase

<ul>
    <li  v-for="(lab, index) in $frontmatter.labs" :key="index">
    <a :href="'/practicas/'+lab">{{lab}}</a>
    </li>
</ul>